openapi: 3.0.0
info:
  title: 'SSTManager API'
  description: 'Documentación oficial del sistema SSTManager'
  version: 1.0.0
servers:
  -
    url: /sstmanager-backend/public
    description: 'Servidor Local'
paths:
  '/index.php?table=calificaciones':
    get:
      tags:
        - 'Admin - Calificaciones'
      summary: 'Listar todas las escalas de calificación activas'
      operationId: d22435e840bc588509c4b46e06d13d0e
      responses:
        '200':
          description: 'Lista obtenida'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Calificacion'
    post:
      tags:
        - 'Admin - Calificaciones'
      summary: 'Crear nueva escala de calificación'
      operationId: cefa5d4112b8ad94ff410d1bb04d3dab
      requestBody:
        required: true
        content:
          application/json:
            schema:
              properties:
                nombre:
                  type: string
                  example: 'Evaluación Anual'
              type: object
      responses:
        '201':
          description: Creado
  '/index.php?table=calificaciones&id={id}':
    get:
      tags:
        - 'Admin - Calificaciones'
      summary: 'Obtener una calificación con sus detalles'
      operationId: c388beb470bc30d573c5fdddc29bf3f6
      parameters:
        -
          name: id
          in: query
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 'Objeto completo'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Calificacion'
        '404':
          description: 'No encontrado'
    put:
      tags:
        - 'Admin - Calificaciones'
      summary: 'Actualizar nombre de la calificación'
      operationId: 4db2e77f7c70c0353c433aa328e8fc39
      parameters:
        -
          name: id
          in: query
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              properties:
                nombre:
                  type: string
              type: object
      responses:
        '200':
          description: Actualizado
    delete:
      tags:
        - 'Admin - Calificaciones'
      summary: 'Eliminar calificación (Borrado Lógico)'
      description: 'No elimina el registro de la BD, solo cambia el estado a ''Inactivo''.'
      operationId: cc97408c0066d56fe0076620454ea56c
      parameters:
        -
          name: id
          in: query
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 'Estado cambiado'
  '/index.php?table=categorias':
    get:
      tags:
        - 'Admin - Categorias'
      summary: 'Listar categorias activas (estado 1)'
      operationId: 5c55bca0b7b8a7664fd366be8722e737
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CategoriaResponse'
    post:
      tags:
        - 'Admin - Categorias'
      summary: 'Crear nueva categoria'
      description: 'Solo requiere los campos manuales. El ID y Estado son automáticos.'
      operationId: 303a8326f9d32f8a49b91dbdb0da877a
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CategoriaRequest'
      responses:
        '201':
          description: 'Categoria creada exitosamente'
  '/index.php?table=categorias&id={id}':
    put:
      tags:
        - 'Admin - Categorias'
      summary: 'Actualizar categoria existente'
      operationId: fe0bc8303803a0fbf578bc21754114b8
      parameters:
        -
          name: id
          in: query
          description: 'ID autoincrementable de la categoría'
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CategoriaRequest'
      responses:
        '200':
          description: 'Actualizado con éxito'
    delete:
      tags:
        - 'Admin - Categorias'
      summary: 'Inactivar categoria (Borrado Lógico)'
      operationId: 5a541f5fa5b70e220b7f191097ed25b7
      parameters:
        -
          name: id
          in: query
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 'Estado cambiado a 0'
  '/index.php?table=categoria_tipos':
    get:
      tags:
        - 'Admin - Categorias'
      summary: 'Listar todos los tipos activos'
      operationId: 85f1fc990ab920a98a67fcf4d5874db3
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CategoriaTipoResponse'
    post:
      tags:
        - 'Admin - Categorias'
      summary: 'Crear nuevo tipo de categoría'
      operationId: 38766335f1108aa4cb829967375dd0cc
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CategoriaTipoRequest'
      responses:
        '201':
          description: 'Creado con éxito'
  '/index.php?table=categoria_tipos&id={id}':
    put:
      tags:
        - 'Admin - Categorias'
      summary: 'Actualizar tipo de categoría'
      operationId: 9d584165b8224185c0c954b177f6e02a
      parameters:
        -
          name: id
          in: query
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CategoriaTipoRequest'
      responses:
        '200':
          description: Actualizado
    delete:
      tags:
        - 'Admin - Categorias'
      summary: 'Inactivar tipo (Borrado Lógico)'
      operationId: e12931f43412891d2d69dda38b0be6de
      parameters:
        -
          name: id
          in: query
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 'Estado cambiado a 0'
  '/index.php?table=ciclos_phva':
    get:
      tags:
        - 'Admin - Catálogos'
      summary: 'Listar todos los ciclos PHVA'
      description: 'Devuelve la lista para llenar el select ''Ciclo al PHVA'' del formulario.'
      operationId: d4111d3c478f9b5c2562dafef2a4a4ee
      responses:
        '200':
          description: 'Operación exitosa'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Ciclo'
        '500':
          description: 'Error interno'
  '/index.php?table=ciclos_phva&id={id}':
    get:
      tags:
        - 'Admin - Catálogos'
      summary: 'Obtener un ciclo por ID'
      operationId: cf57fd65941478e02cde6c5b3a4baa85
      parameters:
        -
          name: id
          in: query
          description: 'ID del ciclo a buscar'
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 'Ciclo encontrado'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Ciclo'
        '404':
          description: 'No encontrado'
  /empresas:
    get:
      tags:
        - 'Admin - Empresas'
      summary: 'Listar todas las empresas'
      description: 'Ruta real: /index.php?table=empresas'
      operationId: getEmpresasList
      responses:
        '200':
          description: 'Lista de empresas'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Empresa'
    post:
      tags:
        - 'Admin - Empresas'
      summary: 'Registrar empresa'
      operationId: createEmpresa
      requestBody:
        required: true
        content:
          application/json:
            schema:
              required:
                - nombre_empresa
                - nit
                - id_plan
              properties:
                nombre_empresa:
                  type: string
                  example: 'Empresa SAS'
                nit:
                  type: string
                  example: '900123456'
                id_plan:
                  type: integer
                  example: 1
                email_contacto:
                  type: string
                telefono:
                  type: string
                direccion:
                  type: string
              type: object
      responses:
        '201':
          description: Creada
  '/empresas/{id}':
    get:
      tags:
        - 'Admin - Empresas'
      summary: 'Obtener detalle de empresa'
      description: 'Ruta real: /index.php?table=empresas&id={id}'
      operationId: getEmpresaDetail
      parameters:
        -
          name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Detalle
    put:
      tags:
        - 'Admin - Empresas'
      summary: 'Actualizar empresa'
      operationId: updateEmpresa
      parameters:
        -
          name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Empresa'
      responses:
        '200':
          description: Actualizada
    delete:
      tags:
        - 'Admin - Empresas'
      summary: 'Inactivar empresa'
      operationId: deleteEmpresa
      parameters:
        -
          name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Inactivada
  /modulos:
    get:
      tags:
        - 'Admin - Catálogos'
      summary: 'Listar módulos y funciones'
      operationId: getModulosList
      parameters:
        -
          name: todos
          in: query
          required: false
          schema:
            type: string
            enum:
              - 'true'
              - 'false'
      responses:
        '200':
          description: Exitoso
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Modulo'
    post:
      tags:
        - 'Admin - Catálogos'
      summary: 'Crear módulo o función'
      operationId: createModulo
      requestBody:
        required: true
        content:
          application/json:
            schema:
              required:
                - nombre_modulo
              properties:
                nombre_modulo:
                  type: string
                  example: Inventarios
                descripcion:
                  type: string
                  example: 'Control de stock'
                icono:
                  type: string
                  example: 'fas fa-box'
                id_padre:
                  type: integer
                  example: 0
                  nullable: true
              type: object
      responses:
        '201':
          description: Creado
  '/modulos/{id}':
    put:
      tags:
        - 'Admin - Catálogos'
      summary: 'Actualizar módulo'
      operationId: updateModulo
      parameters:
        -
          name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              properties:
                nombre_modulo:
                  type: string
                id_padre:
                  type: integer
                  nullable: true
                estado:
                  type: integer
              type: object
      responses:
        '200':
          description: Actualizado
  /perfiles:
    get:
      tags:
        - 'Seguridad - Perfiles'
      summary: 'Listar perfiles de seguridad'
      operationId: getPerfilesList
      parameters:
        -
          name: id_empresa
          in: query
          required: false
          schema:
            type: integer
      responses:
        '200':
          description: Exitoso
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Perfil'
    post:
      tags:
        - 'Seguridad - Perfiles'
      summary: 'Crear nuevo perfil'
      operationId: createPerfil
      requestBody:
        required: true
        content:
          application/json:
            schema:
              required:
                - nombre_perfil
              properties:
                nombre_perfil:
                  type: string
                  example: Administrador
                descripcion:
                  type: string
                  example: 'Acceso total al sistema'
                id_empresa:
                  type: integer
                  nullable: true
              type: object
      responses:
        '201':
          description: Creado
  '/perfiles/{id}':
    put:
      tags:
        - 'Seguridad - Perfiles'
      summary: 'Actualizar perfil'
      operationId: updatePerfil
      parameters:
        -
          name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              properties:
                nombre_perfil:
                  type: string
                descripcion:
                  type: string
                estado:
                  type: integer
              type: object
      responses:
        '200':
          description: Actualizado
    delete:
      tags:
        - 'Seguridad - Perfiles'
      summary: 'Desactivar perfil'
      operationId: 885b69de8db836560f534225ce91a43c
      parameters:
        -
          name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Desactivado
  /planes:
    get:
      tags:
        - 'Admin - Planes'
      summary: 'Listar todos los planes'
      description: 'Ruta real: /index.php?table=planes'
      operationId: getPlanesList
      responses:
        '200':
          description: 'Lista de planes comerciales'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Plan'
    post:
      tags:
        - 'Admin - Planes'
      summary: 'Crear un nuevo plan comercial'
      description: 'Ruta real: /index.php?table=planes (POST)'
      operationId: createPlan
      requestBody:
        required: true
        content:
          application/json:
            schema:
              required:
                - nombre_plan
                - modulos
              properties:
                nombre_plan:
                  type: string
                  example: 'Plan Pro'
                descripcion:
                  type: string
                  example: 'Acceso a módulos avanzados'
                limite_usuarios:
                  type: integer
                  example: 20
                precio_mensual:
                  type: number
                  example: 59.9
                modulos:
                  type: array
                  items: { type: integer }
                  example: [1, 2, 3]
              type: object
      responses:
        '201':
          description: 'Plan creado'
  '/planes/{id}':
    get:
      tags:
        - 'Admin - Planes'
      summary: 'Obtener detalle de un plan'
      description: 'Ruta real: /index.php?table=planes&id={id}'
      operationId: getPlanDetail
      parameters:
        -
          name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 'Detalle del plan'
    put:
      tags:
        - 'Admin - Planes'
      summary: 'Actualización total del plan'
      description: 'Ruta real: /index.php?table=planes&id={id} (PUT)'
      operationId: updatePlan
      parameters:
        -
          name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Plan'
      responses:
        '200':
          description: 'Plan actualizado'
    delete:
      tags:
        - 'Admin - Planes'
      summary: 'Desactivar plan'
      description: 'Ruta real: /index.php?table=planes&id={id} (DELETE)'
      operationId: deletePlan
      parameters:
        -
          name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Desactivado
    patch:
      tags:
        - 'Admin - Planes'
      summary: 'Actualización parcial'
      operationId: patchPlan
      parameters:
        -
          name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Actualizado
  '/index.php?action=login':
    post:
      tags:
        - Auth
      summary: 'Obtener Token JWT'
      description: 'Envía email y contraseña para recibir un token de acceso.'
      operationId: 910523e1273abe562f05556dd91d1cec
      requestBody:
        required: true
        content:
          application/json:
            schema:
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  example: admin@sst.com
                password:
                  type: string
                  example: '123456'
              type: object
      responses:
        '200':
          description: 'Token generado'
          content:
            application/json:
              schema:
                properties:
                  status: { type: string, example: success }
                  token: { type: string, example: eyJ0eXAiOiJK... }
                  user: { $ref: '#/components/schemas/Usuario' }
                type: object
        '401':
          description: 'Credenciales inválidas'
  '/index.php?table=usuarios':
    get:
      tags:
        - Auth
      summary: 'Listar usuarios con filtros de empresa'
      operationId: f98178c21d4e9e676798b8c445ebd08e
      parameters:
        -
          name: id_empresa
          in: query
          description: 'Filtrar por empresa (opcional para Master)'
          required: false
          schema:
            type: integer
      responses:
        '200':
          description: 'Lista de usuarios'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Usuario'
    post:
      tags:
        - Auth
      summary: 'Crear usuario'
      operationId: 96c727d02a352e221c245a3430cfc3c7
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Usuario'
      responses:
        '201':
          description: 'Usuario creado con éxito'
  '/index.php?table=usuarios&id={id}':
    get:
      tags:
        - Auth
      summary: 'Obtener un usuario por ID'
      operationId: e6fe7eaba59ce6b15b5b8b83b33daad4
      parameters:
        -
          name: id
          in: query
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 'Datos del usuario'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Usuario'
    put:
      tags:
        - Auth
      summary: 'Reemplazar usuario (Actualización Completa)'
      operationId: c69349d1a423980f15bfec6fd8b10415
      parameters:
        -
          name: id
          in: query
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Usuario'
      responses:
        '200':
          description: 'Usuario actualizado correctamente'
    delete:
      tags:
        - Auth
      summary: 'Inactivar Usuario'
      operationId: e4755b8d3ea3a46193fe98cf696a76e2
      parameters:
        -
          name: id
          in: query
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 'Estado cambiado a inactivo'
    patch:
      tags:
        - Auth
      summary: 'Actualización Parcial (Solo campos enviados)'
      operationId: 1aae2fd58bd6d4634240ecb3956b799e
      parameters:
        -
          name: id
          in: query
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              properties:
                email:
                  type: string
                  example: nuevo@correo.com
                nombre:
                  type: string
                id_perfil:
                  type: integer
                estado:
                  type: integer
              type: object
      responses:
        '200':
          description: 'Campo actualizado'
components:
  schemas:
    Calificacion:
      title: Calificación
      properties:
        id:
          type: integer
          example: 1
        nombre:
          type: string
          example: 'Escala SST'
        estado:
          type: integer
          example: 1
        items:
          type: array
          items:
            properties:
              id_detalle:
                type: integer
              descripcion:
                type: string
              valor:
                type: number
            type: object
      type: object
    CategoriaRequest:
      title: 'Cuerpo de Categoria'
      description: 'Campos necesarios para crear o actualizar una categoría (Excluye campos automáticos)'
      properties:
        descripcion:
          type: string
          example: 'RECURSOS FINANCIEROS'
      type: object
    CategoriaResponse:
      title: 'Respuesta de Categoria'
      properties:
        id:
          type: integer
          example: 1
        descripcion:
          type: string
          example: 'RECURSOS FINANCIEROS'
        estado:
          type: integer
          example: 1
      type: object
    CategoriaTipoRequest:
      title: 'Cuerpo de Tipo de Categoría'
      properties:
        categoria_id:
          description: 'ID de la categoría padre'
          type: integer
          example: 1
        descripcion:
          type: string
          example: 'RECURSO HUMANO'
      type: object
    CategoriaTipoResponse:
      title: 'Respuesta de Tipo de Categoría'
      properties:
        id:
          type: integer
          example: 1
        categoria_id:
          type: integer
          example: 1
        descripcion:
          type: string
          example: 'RECURSO HUMANO'
        estado:
          type: integer
          example: 1
      type: object
    Ciclo:
      title: 'Ciclo PHVA'
      description: 'Modelo de los pasos del ciclo PHVA'
      properties:
        id:
          type: integer
          example: 1
        nombre:
          type: string
          example: Planear
      type: object
    Empresa:
      title: 'Empresa Cliente (Tenant)'
    Modulo:
      title: 'Módulo del Sistema'
      description: 'Esquema para la gestión de módulos y funciones (Jerarquía)'
      properties:
        id_modulo:
          type: integer
          example: 1
        id_padre:
          description: 'ID del padre. Si es NULL es un Módulo principal.'
          type: integer
          example: 1
          nullable: true
        nombre_modulo:
          type: string
          example: Usuarios
        descripcion:
          type: string
          example: 'Gestión de acceso'
        icono:
          type: string
          example: 'fas fa-users'
        estado:
          description: '1: Activo, 0: Inactivo'
          type: integer
          example: 1
        tipo_elemento:
          description: 'Calculado: Modulo o Funcion'
          type: string
          example: Modulo
      type: object
    Perfil:
      title: 'Perfil de Usuario'
      properties:
        id_perfil:
          type: integer
          example: 1
        nombre_perfil:
          type: string
          example: Administrador
      type: object
    Permiso:
      title: 'Matriz de Permisos'
    Plan:
      title: 'Plan de Suscripción'
      description: 'Define los límites comerciales y módulos permitidos para una empresa'
    Usuario:
      title: 'Modelo de Usuario'
      description: 'Esquema que representa a un usuario dentro del ecosistema Multi-tenant'
      required:
        - nombre
        - apellido
        - email
        - tipo_documento
        - numero_documento
        - rol
        - id_perfil
      properties:
        id_usuario:
          type: integer
          example: 1
        nombre:
          type: string
          example: Juan
        apellido:
          type: string
          example: Pérez
        email:
          type: string
          format: email
          example: juan.perez@sst.com
        tipo_documento:
          type: string
          example: CC
        numero_documento:
          type: string
          example: '123456789'
        rol:
          type: string
          enum:
            - master
            - administrador-cliente
            - usuario
            - soporte
          example: administrador-cliente
        id_empresa:
          description: 'ID de la empresa (null si es master o soporte)'
          type: integer
          example: 1
          nullable: true
        id_perfil:
          description: 'ID del perfil de permisos asociado'
          type: integer
          example: 2
        password:
          description: 'Contraseña (solo para envío en POST/PUT)'
          type: string
          writeOnly: true
          example: password123
        estado:
          description: '1: Activo, 0: Inactivo'
          type: integer
          example: 1
      type: object
tags:
  -
    name: Auth
    description: 'Gestión de Tokens y Acceso'
  -
    name: 'Admin - Calificaciones'
    description: 'Admin - Calificaciones'
  -
    name: 'Admin - Categorias'
    description: 'Admin - Categorias'
  -
    name: 'Admin - Catálogos'
    description: 'Admin - Catálogos'
  -
    name: 'Admin - Empresas'
    description: 'Admin - Empresas'
  -
    name: 'Seguridad - Perfiles'
    description: 'Seguridad - Perfiles'
  -
    name: 'Admin - Planes'
    description: 'Admin - Planes'
